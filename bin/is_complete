#!/usr/bin/env python

import os
import json
import pprint
import sys

path = sys.argv[1] if len(sys.argv) > 1 else os.path.join(os.path.dirname(__file__), "../")
path = os.path.abspath(path)

def check_is_complete(directory):
   with open(os.path.join(directory, "early_stopping.json"), "r") as json_file:
      early_stopping = json.load(json_file)
   return early_stopping["wait"] >= early_stopping["patience"]

def is_complete(directory):
   incomplete = []
   complete = []
   for root, dirs, files in os.walk(directory):
      if "logs" not in dirs or "early_stopping.json" not in files:
         continue

      if not check_is_complete(root):
         print("WARNING: %s is not complete!" % os.path.abspath(root))
         incomplete.append(os.path.abspath(root))
         continue
      complete.append(os.path.abspath(root))
   return complete, incomplete

if __name__ == "__main__":
   complete, incomplete = is_complete(path)
   pprint.pprint({
      "Complete": complete,
      "Incomplete": incomplete
   })
   if len(incomplete) > 0:
      sys.exit(1)
